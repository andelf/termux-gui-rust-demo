# Termux:GUI Rust Demo æ•…éšœæ’æŸ¥æŒ‡å—

## å¸¸è§é—®é¢˜é€ŸæŸ¥è¡¨

| ç—‡çŠ¶ | å¯èƒ½åŸå›  | è§£å†³æ–¹æ¡ˆ |
|------|---------|---------|
| ç¼–è¯‘å¤±è´¥ | ä¸åœ¨ HOME ç›®å½• | `cd ~ && é‡æ–°ç¼–è¯‘` |
| Permission denied | æ–‡ä»¶æ²¡æœ‰æ‰§è¡Œæƒé™ | `chmod +x target/release/termux-gui-rust-demo` |
| è¿æ¥è¶…æ—¶ | æ’ä»¶æœªå®‰è£…/æœªè¿è¡Œ | å®‰è£… Termux:GUI æ’ä»¶ |
| ä¸€é—ªè€Œè¿‡ | è‡ªåŠ¨é€€å‡ºå¤ªå¿« | ä½¿ç”¨ç­‰å¾…æ¨¡å¼ï¼ˆé»˜è®¤ï¼‰ |
| é»‘å±/æ— ç•Œé¢ | Activity åˆ›å»ºå¤±è´¥ | æŸ¥çœ‹é”™è¯¯æ—¥å¿— |

---

## è¯¦ç»†æ•…éšœæ’æŸ¥

### 1. ç¼–è¯‘é—®é¢˜

#### é—®é¢˜ï¼š`Permission denied (os error 13)`

```
error: failed to run custom build command for `serde_json v1.0.145`
Caused by: Permission denied (os error 13)
```

**åŸå› **: åœ¨éå¯æ‰§è¡Œç›®å½•ç¼–è¯‘ï¼ˆå¦‚ `/storage/emulated/0`ï¼‰

**è§£å†³**:
```bash
# æ£€æŸ¥å½“å‰ç›®å½•
pwd

# å¦‚æœä¸åœ¨ HOMEï¼Œç§»åŠ¨é¡¹ç›®
mv /storage/emulated/0/Documents/termux-gui-rust-demo ~/

# è¿›å…¥ HOME ç›®å½•é‡æ–°ç¼–è¯‘
cd ~/termux-gui-rust-demo
cargo clean
cargo build --release
```

#### é—®é¢˜ï¼šç¼–è¯‘æ—¶é—´è¿‡é•¿æˆ–å¡ä½

**è§£å†³**:
```bash
# æ¸…ç†ç¼“å­˜é‡è¯•
cargo clean
cargo build --release

# å¦‚æœè¿˜æ˜¯å¾ˆæ…¢ï¼Œæ£€æŸ¥ç½‘ç»œ
ping -c 3 crates.io

# ä½¿ç”¨å›½å†…é•œåƒï¼ˆå¯é€‰ï¼‰
cat >> ~/.cargo/config.toml << 'EOF'
[source.crates-io]
replace-with = 'ustc'

[source.ustc]
registry = "https://mirrors.ustc.edu.cn/crates.io-index"
EOF
```

---

### 2. è¿è¡Œæ—¶é—®é¢˜

#### é—®é¢˜ï¼š`paths must not contain interior null bytes`

```
Error: Error { kind: InvalidInput, message: "paths must not contain interior null bytes" }
```

**åŸå› **: ä½¿ç”¨äº†æ—§ç‰ˆæœ¬ä»£ç ï¼Œæ²¡æœ‰ä½¿ç”¨ `bind_abstract_socket`

**è§£å†³**:
```bash
# ç¡®ä¿ä»£ç å·²æ›´æ–°
cd ~/termux-gui-rust-demo
git pull  # å¦‚æœæ˜¯ git ä»“åº“
# æˆ–é‡æ–°ä¸‹è½½æœ€æ–°ä»£ç 

# é‡æ–°ç¼–è¯‘
cargo build --release
```

#### é—®é¢˜ï¼šè¿æ¥è¶…æ—¶

```
Socketå·²ç»‘å®šï¼Œç­‰å¾…è¿æ¥...
ï¼ˆé•¿æ—¶é—´æ— å“åº”ï¼‰
```

**åŸå› **: Termux:GUI æ’ä»¶æœªå®‰è£…æˆ–æœªè¿è¡Œ

**è§£å†³æ­¥éª¤**:

1. **æ£€æŸ¥æ’ä»¶æ˜¯å¦å®‰è£…**:
```bash
pm list packages | grep termux.gui
```
åº”è¯¥çœ‹åˆ°: `package:com.termux.gui`

2. **å¦‚æœæœªå®‰è£…**:
- ä» F-Droid ä¸‹è½½: https://f-droid.org/packages/com.termux.gui/
- æˆ–ä» GitHub Releases: https://github.com/termux/termux-gui/releases

3. **é‡å¯ Termux**:
```bash
exit
# é‡æ–°æ‰“å¼€ Termux
```

4. **æ£€æŸ¥æ’ä»¶æƒé™**:
- æ‰“å¼€ Android è®¾ç½®
- åº”ç”¨ç®¡ç† â†’ Termux:GUI
- ç¡®ä¿æ‰€æœ‰æƒé™å·²æˆäºˆ

#### é—®é¢˜ï¼šActivity åˆ›å»ºå¤±è´¥

```
Error: "æ— æ³•è·å–Activity ID"
```

**è°ƒè¯•æ­¥éª¤**:

1. **æŸ¥çœ‹è¯¦ç»†è¾“å‡º**:
```bash
cd ~/termux-gui-rust-demo
./target/release/termux-gui-rust-demo 2>&1 | tee debug.log
cat debug.log
```

2. **æ£€æŸ¥è¿”å›å€¼**:
çœ‹ "æ¥æ”¶æ¶ˆæ¯" è¡Œï¼Œåº”è¯¥æ˜¯ `[æ•°å­—, æ•°å­—]` æ ¼å¼

3. **æµ‹è¯• Python ç‰ˆæœ¬**:
```bash
pip install termuxgui
python3 << 'EOF'
import termuxgui as tg
with tg.Connection() as c:
    a = tg.Activity(c)
    print(f"Activity ID: {a.aid}")
EOF
```

å¦‚æœ Python ç‰ˆæœ¬ä¹Ÿå¤±è´¥ï¼Œè¯´æ˜æ˜¯æ’ä»¶é—®é¢˜ã€‚

#### é—®é¢˜ï¼šç•Œé¢ä¸€é—ªè€Œè¿‡

**åŸå› **: ç¨‹åºè¿è¡Œåœ¨è‡ªåŠ¨æ¨¡å¼æˆ–ä¸»çº¿ç¨‹é€€å‡ºå¤ªå¿«

**è§£å†³**:
```bash
# ä½¿ç”¨ç­‰å¾…æ¨¡å¼ï¼ˆé»˜è®¤ï¼‰
./target/release/termux-gui-rust-demo

# æˆ–ä½¿ç”¨è‡ªåŠ¨æ¨¡å¼ä½†å»¶é•¿æ—¶é—´ï¼ˆéœ€ä¿®æ”¹ä»£ç ï¼‰
AUTO_MODE=1 ./target/release/termux-gui-rust-demo
```

**ä¸´æ—¶è§£å†³**ï¼ˆä¸å…³é—­ Activityï¼‰:
ä¿®æ”¹ä»£ç ï¼Œæ³¨é‡Šæ‰å…³é—­ Activity çš„éƒ¨åˆ†ã€‚

---

### 3. æ˜¾ç¤ºé—®é¢˜

#### é—®é¢˜ï¼šé»‘å±æˆ–ç©ºç™½

**å¯èƒ½åŸå› **:
1. TextView åˆ›å»ºå¤±è´¥
2. Activity æ²¡æœ‰æ­£ç¡®æ˜¾ç¤º
3. æ–‡æœ¬é¢œè‰²ä¸èƒŒæ™¯ç›¸åŒ

**è°ƒè¯•**:
```bash
# æŸ¥çœ‹å®Œæ•´æ—¥å¿—
./target/release/termux-gui-rust-demo 2>&1 | tee full.log

# æ£€æŸ¥æ˜¯å¦æœ‰ "TextViewåˆ›å»ºæˆåŠŸ" æ¶ˆæ¯
grep "TextView" full.log
```

**å°è¯•ä¿®æ”¹æ–‡æœ¬**:
ç¼–è¾‘ `src/main.rs`ï¼Œä¿®æ”¹æ–‡æœ¬å†…å®¹ï¼š
```rust
"text": "Hello World from Rust! ğŸ¦€\n\nTEST TEST TEST"
```

#### é—®é¢˜ï¼šä¸­æ–‡æ˜¾ç¤ºä¹±ç 

**è§£å†³**:
```bash
# æ£€æŸ¥ç»ˆç«¯ç¼–ç 
locale

# åº”è¯¥çœ‹åˆ° UTF-8
# å¦‚æœä¸æ˜¯ï¼Œè®¾ç½®ï¼š
export LANG=en_US.UTF-8
export LC_ALL=en_US.UTF-8
```

---

### 4. äº‹ä»¶å¤„ç†é—®é¢˜

#### é—®é¢˜ï¼šæ²¡æœ‰æ”¶åˆ°äº‹ä»¶

**æ£€æŸ¥**:
```bash
# è¿è¡Œç¨‹åºå¹¶è§‚å¯Ÿè¾“å‡º
./target/release/termux-gui-rust-demo

# åº”è¯¥çœ‹åˆ°ç±»ä¼¼è¾“å‡ºï¼š
# ğŸ“¨ æ”¶åˆ°äº‹ä»¶: {"type":"create",...}
# ğŸ“¨ æ”¶åˆ°äº‹ä»¶: {"type":"start",...}
# ğŸ“¨ æ”¶åˆ°äº‹ä»¶: {"type":"resume",...}
```

**å¦‚æœæ²¡æœ‰äº‹ä»¶è¾“å‡º**:
- Event Socket å¯èƒ½è¿æ¥å¤±è´¥
- æŸ¥çœ‹æ˜¯å¦æœ‰ "âœ“ Event Socket å·²è¿æ¥" æ¶ˆæ¯

#### é—®é¢˜ï¼šç¨‹åºä¸å“åº”å…³é—­

**åŸå› **: äº‹ä»¶å¾ªç¯å¯èƒ½å¡ä½

**è§£å†³**:
```bash
# å¼ºåˆ¶ç»ˆæ­¢
Ctrl+C

# æˆ–åœ¨å¦ä¸€ä¸ªç»ˆç«¯
pkill termux-gui-rust-demo
```

---

### 5. æ€§èƒ½é—®é¢˜

#### é—®é¢˜ï¼šå¯åŠ¨å¾ˆæ…¢

**å¯èƒ½åŸå› **:
1. Debug æ¨¡å¼ç¼–è¯‘
2. ç³»ç»Ÿèµ„æºä¸è¶³

**è§£å†³**:
```bash
# ç¡®ä¿ä½¿ç”¨ release æ¨¡å¼
ls -lh target/release/termux-gui-rust-demo

# å¦‚æœæ–‡ä»¶ä¸å­˜åœ¨æˆ–å¾ˆå¤§ï¼ˆ>2MBï¼‰ï¼Œé‡æ–°ç¼–è¯‘
cargo build --release

# release ç‰ˆæœ¬åº”è¯¥çº¦ 750KB
```

#### é—®é¢˜ï¼šå†…å­˜å ç”¨é«˜

**æ­£å¸¸å€¼**: ~3MB

**æ£€æŸ¥**:
```bash
# è¿è¡Œç¨‹åºåï¼Œåœ¨å¦ä¸€ä¸ªç»ˆç«¯
ps aux | grep termux-gui-rust-demo

# VSZ åˆ—æ˜¾ç¤ºè™šæ‹Ÿå†…å­˜ï¼ŒRSS åˆ—æ˜¾ç¤ºå®é™…å†…å­˜
```

**å¦‚æœè¶…è¿‡ 10MB**: å¯èƒ½æ˜¯ debug æ¨¡å¼æˆ–å†…å­˜æ³„æ¼

---

## ç¯å¢ƒæ£€æŸ¥æ¸…å•

è¿è¡Œä»¥ä¸‹å‘½ä»¤æ£€æŸ¥ç¯å¢ƒï¼š

```bash
#!/bin/bash

echo "=== Termux:GUI ç¯å¢ƒæ£€æŸ¥ ==="
echo ""

echo "1. æ£€æŸ¥ Rust ç¯å¢ƒ:"
rustc --version 2>&1 || echo "âŒ Rust æœªå®‰è£…"
cargo --version 2>&1 || echo "âŒ Cargo æœªå®‰è£…"
echo ""

echo "2. æ£€æŸ¥ Termux:GUI æ’ä»¶:"
if pm list packages | grep -q termux.gui; then
    echo "âœ… Termux:GUI å·²å®‰è£…"
else
    echo "âŒ Termux:GUI æœªå®‰è£…"
fi
echo ""

echo "3. æ£€æŸ¥é¡¹ç›®ä½ç½®:"
pwd
if [[ $(pwd) == /data/data/com.termux/files/home* ]]; then
    echo "âœ… åœ¨ HOME ç›®å½•"
else
    echo "âš ï¸  ä¸åœ¨ HOME ç›®å½•ï¼Œå¯èƒ½å¯¼è‡´æƒé™é—®é¢˜"
fi
echo ""

echo "4. æ£€æŸ¥ç¼–è¯‘äº§ç‰©:"
if [ -f ~/termux-gui-rust-demo/target/release/termux-gui-rust-demo ]; then
    echo "âœ… äºŒè¿›åˆ¶æ–‡ä»¶å­˜åœ¨"
    ls -lh ~/termux-gui-rust-demo/target/release/termux-gui-rust-demo
else
    echo "âŒ äºŒè¿›åˆ¶æ–‡ä»¶ä¸å­˜åœ¨ï¼Œéœ€è¦ç¼–è¯‘"
fi
echo ""

echo "5. æ£€æŸ¥æƒé™:"
if [ -x ~/termux-gui-rust-demo/target/release/termux-gui-rust-demo ]; then
    echo "âœ… å¯æ‰§è¡Œæƒé™æ­£ç¡®"
else
    echo "âŒ ç¼ºå°‘å¯æ‰§è¡Œæƒé™"
fi
echo ""

echo "=== æ£€æŸ¥å®Œæˆ ==="
```

ä¿å­˜ä¸º `check_env.sh` å¹¶è¿è¡Œï¼š
```bash
chmod +x check_env.sh
./check_env.sh
```

---

## è·å–å¸®åŠ©

### æŸ¥çœ‹æ—¥å¿—

```bash
# å®Œæ•´æ—¥å¿—
./target/release/termux-gui-rust-demo 2>&1 | tee debug.log

# è¯¦ç»†é”™è¯¯è·Ÿè¸ª
RUST_BACKTRACE=full ./target/release/termux-gui-rust-demo 2>&1 | tee debug.log
```

### å¯¹æ¯” Python ç‰ˆæœ¬

å¦‚æœ Rust ç‰ˆæœ¬æœ‰é—®é¢˜ï¼Œå°è¯• Python ç‰ˆæœ¬ï¼š

```bash
pip install termuxgui

python3 << 'EOF'
import termuxgui as tg
import time

with tg.Connection() as c:
    a = tg.Activity(c)
    tv = tg.TextView(a, "Python Test")
    time.sleep(3)
EOF
```

å¦‚æœ Python ç‰ˆæœ¬æ­£å¸¸ï¼Œè¯´æ˜é—®é¢˜åœ¨ Rust å®ç°ã€‚  
å¦‚æœ Python ç‰ˆæœ¬ä¹Ÿå¤±è´¥ï¼Œè¯´æ˜æ˜¯æ’ä»¶æˆ–ç³»ç»Ÿé—®é¢˜ã€‚

### é‡ç½®é¡¹ç›®

```bash
cd ~/termux-gui-rust-demo
cargo clean
cargo build --release
./target/release/termux-gui-rust-demo
```

---

## å·²çŸ¥é—®é¢˜

### 1. Android ç‰ˆæœ¬å…¼å®¹æ€§

- **æœ€ä½è¦æ±‚**: Android 7.0 (API 24)
- **æ¨è**: Android 10+ (API 29+)

### 2. æƒé™é—®é¢˜

æŸäº› Android è®¾å¤‡å¯èƒ½é™åˆ¶ Termux çš„åå°è¿è¡Œæˆ–æ˜¾ç¤ºæ‚¬æµ®çª—ã€‚

**è§£å†³**:
- è®¾ç½® â†’ åº”ç”¨ç®¡ç† â†’ Termux
- å…è®¸åå°è¿è¡Œ
- å…è®¸æ˜¾ç¤ºåœ¨å…¶ä»–åº”ç”¨ä¸Šå±‚

### 3. æ’ä»¶ç‰ˆæœ¬

ç¡®ä¿ä½¿ç”¨æœ€æ–°ç‰ˆæœ¬çš„ Termux:GUI æ’ä»¶ã€‚

**æ£€æŸ¥ç‰ˆæœ¬**:
```bash
pm dump com.termux.gui | grep versionName
```

---

## è°ƒè¯•æŠ€å·§

### 1. é€æ­¥è°ƒè¯•

åœ¨ä»£ç ä¸­æ·»åŠ æ›´å¤š `println!` è¯­å¥ï¼š

```rust
println!("DEBUG: å‡†å¤‡å‘é€æ¶ˆæ¯");
send_message(&mut main_stream, &activity_msg)?;
println!("DEBUG: æ¶ˆæ¯å·²å‘é€");

let response = read_message(&mut main_stream)?;
println!("DEBUG: æ”¶åˆ°å“åº”: {:?}", response);
```

### 2. ä½¿ç”¨ straceï¼ˆé«˜çº§ï¼‰

```bash
# è·Ÿè¸ªç³»ç»Ÿè°ƒç”¨
strace -e trace=socket,bind,connect,sendto,recvfrom \
    ./target/release/termux-gui-rust-demo 2>&1 | tee strace.log
```

### 3. æ£€æŸ¥ socket è¿æ¥

```bash
# è¿è¡Œç¨‹åºåï¼Œåœ¨å¦ä¸€ä¸ªç»ˆç«¯
# æŸ¥çœ‹æŠ½è±¡å‘½åç©ºé—´ socket
ss -x | grep termux
```

---

## æŠ¥å‘Šé—®é¢˜

å¦‚æœä»¥ä¸Šæ–¹æ³•éƒ½æ— æ³•è§£å†³é—®é¢˜ï¼Œå‡†å¤‡ä»¥ä¸‹ä¿¡æ¯ï¼š

1. **ç³»ç»Ÿä¿¡æ¯**:
```bash
uname -a
getprop ro.build.version.release
```

2. **Rust ç‰ˆæœ¬**:
```bash
rustc --version
cargo --version
```

3. **æ’ä»¶ç‰ˆæœ¬**:
```bash
pm dump com.termux.gui | grep versionName
```

4. **å®Œæ•´æ—¥å¿—**:
```bash
RUST_BACKTRACE=full ./target/release/termux-gui-rust-demo 2>&1 > full.log
```

---

**æœ€åæ›´æ–°**: 2025  
**çŠ¶æ€**: æŒç»­ç»´æŠ¤
